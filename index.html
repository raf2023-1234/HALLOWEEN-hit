<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Halloween-Hit </title>
<style>
  :root { --card:#1c1a2b; --stroke:#2c2942; }
  html, body { height: 100%; margin: 0; background:#0b0a10; color:#fff; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Noto Sans, "PingFang TC","Hiragino Sans","Microsoft JhengHei", sans-serif; }
  .wrap { display:flex; flex-direction:column; height:100%; }
  header { padding:10px 16px; display:flex; align-items:center; gap:12px; background:linear-gradient(180deg,#191726,#0b0a10); border-bottom:1px solid var(--stroke); }
  header h1 { font-size:18px; margin:0; letter-spacing:.5px; }
  .hud { display:flex; gap:14px; margin-left:auto; font-weight:600; align-items:center; }
  .hud span { padding:.25rem .5rem; background:var(--card); border:1px solid var(--stroke); border-radius:10px; min-width:80px; text-align:center; }
  #gameArea { position:relative; flex:1; display:grid; place-items:center; padding:12px; }
  canvas { width:min(100%, 980px); height:auto; max-height: calc(100vh - 170px); background:#000; border:1px solid var(--stroke); border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.35) inset; }
  .overlay { position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; }
  .panel { pointer-events:auto; width:min(92vw,760px); background:rgba(18,15,24,.88); border:1px solid var(--stroke); border-radius:16px; padding:24px; box-shadow:0 20px 60px rgba(0,0,0,.5); text-align:center; opacity:0; animation:fadeIn .7s ease forwards; }
  .panel h2 { margin-top:0; }
  .row { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
  button { cursor:pointer; border:none; padding:12px 16px; border-radius:12px; font-weight:700; letter-spacing:.5px; background:#ff7a18; color:#160b00; box-shadow:0 8px 20px rgba(255,122,24,.25); }
  button:hover { filter:brightness(1.05); }
  .btn-secondary { background:#4dd1ff; color:#00131d; box-shadow:0 8px 20px rgba(77,209,255,.2); }
  footer { font-size:12px; opacity:.75; text-align:center; padding:8px; }
  .toast{ position:absolute; left:50%; top:12%; transform:translateX(-50%); background:rgba(0,0,0,.65); border:1px solid #464068; padding:10px 14px; border-radius:10px; font-weight:700; letter-spacing:.5px; opacity:0; transition:opacity .35s ease; }
  .toast.show{ opacity:1; }
  .audio-ui { display:flex; gap:8px; align-items:center; background:var(--card); border:1px solid var(--stroke); border-radius:10px; padding:4px 8px; }
  .audio-ui input[type=range]{ width:120px; }
  .dbg { font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; position:absolute; right:8px; bottom:8px; background:rgba(0,0,0,.45); border:1px solid #3a3552; border-radius:8px; padding:6px 8px; opacity:.85; }
  @keyframes fadeIn { from { opacity:0 } to { opacity:1 } }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ğŸƒ Halloween </h1>
    <div class="hud">
      <span>Levelï¼š<b id="hud-level">1 / 3</b></span>
      <span>Timeï¼š<b id="hud-time">0</b>s</span>
      <span>Scoreï¼š<b id="hud-score">0</b></span>
      <span>Comboï¼š<b id="hud-combo">0</b>x</span>
      <div class="audio-ui">
        <button id="btnAudio">ğŸ”Š Music On</button>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.85" title="volume">
      </div>
    </div>
  </header>
  <div id="gameArea">
    <canvas id="game" width="980" height="640"></canvas>
    <div class="overlay" id="overlay">
      <div class="panel" id="panelStart">
        <h2>Halloween </h2>
        <p>æŒ‰ã€Œé–‹å§‹éŠæˆ²ã€é€²å…¥ç¬¬ 1 é—œã€‚Click "Start Game" to enter level 1.</p>
        <div class="row">
          <button id="btnStart">é–‹å§‹éŠæˆ²Start Game</button>
          <button class="btn-secondary" id="btnHow">ç©æ³•èªªæ˜How to play</button>
        </div>
      </div>
      <div class="panel" id="panelHow" style="display:none">
        <h2>ç©æ³•èªªæ˜</h2>
        <ul style="text-align:left; line-height:1.6">
          <li>é»æ“Š <b>ç™½è‰²éª·é«</b> å¾—åˆ† </li>
          <li>æ¯é—œ 40 ç§’ï¼Œé”æ¨™è‡ªå‹•å‰å¾€ä¸‹ä¸€é—œã€‚</li>
          <li>ä¸‰ä½é—œä¸»ï¼šç¬¬1é—œ å°å®‰ï¼Œç¬¬2é—œ ä¾å¨œï¼Œç¬¬3é—œ å¨œå¦®ï¼›å®ˆè­·å¤§å®¶ã€‚</li>
          <li>Click the white skull to score.Each level has 40 seconds; reaching the target automatically advances you to the next level.
Three level masters: Level 1 - Ann, Level 2 - Yina, Level 3 - Nani; protecting everyone.</li>
        </ul>
        <div class="row"><button id="btnBack">è¿”å›</button></div>
      </div>
      <div class="panel" id="panelGameOver" style="display:none">
        <h2 id="goTitle">éŠæˆ²çµæŸ</h2>
        <p id="goText"></p>
        <div class="row"><button id="btnRestart">å†ç©ä¸€æ¬¡</button></div>
      </div>
    </div>
    <div id="toast" class="toast">ç¬¬ 1 é—œé€šéï¼è‡ªå‹•å‰å¾€ä¸‹ä¸€é—œâ€¦</div>
    <div class="dbg" id="dbg">audio: init</div>
  </div>
  <footer>Â© 2025 Sole Digital Art CO.</footer>
</div>

<script>
(() => {
  const dbg = (msg) => { const el=document.getElementById('dbg'); el.textContent = 'audio: ' + msg; };
  const cvs = document.getElementById('game'); const ctx = cvs.getContext('2d');
  const hud = { level:document.getElementById('hud-level'), time:document.getElementById('hud-time'), score:document.getElementById('hud-score'), combo:document.getElementById('hud-combo') };
  const overlay = document.getElementById('overlay'); const panelStart=document.getElementById('panelStart'); const panelHow=document.getElementById('panelHow'); const panelGameOver=document.getElementById('panelGameOver'); const goText=document.getElementById('goText'); const toast=document.getElementById('toast');

  // èƒŒæ™¯/å°é¢
  const bgs=[new Image(),new Image(),new Image()]; bgs[0].src='assets/bg01.png'; bgs[1].src='assets/bg02.png'; bgs[2].src='assets/bg03.png'; const cover=new Image(); cover.src='assets/cover.png';

  // é—œä¸»/é»‘è²“
  const bosses=[new Image(),new Image(),new Image()]; bosses[0].src='assets/g1.png'; bosses[1].src='assets/g2.png'; bosses[2].src='assets/g3.png';
  const catImg=new Image(); catImg.src='assets/cat.png';

  // éŸ³æ•ˆ
  const sfxHit=new Audio('assets/BOING.mp3'); sfxHit.volume=0.9; sfxHit.playsInline=true;
  const playHit=()=>{ const a=sfxHit.cloneNode(); a.volume=sfxHit.volume; a.playsInline=true; a.play().catch(()=>{}); };

  // BGM
  const tracks=[ new Audio('assets/music01.mp3'), new Audio('assets/music02.mp3'), new Audio('assets/music03.mp3') ];
  tracks.forEach(t=>{ t.loop=true; t.volume=0; t.preload='auto'; t.playsInline=true; });

  const vol = document.getElementById('vol'); const btnAudio=document.getElementById('btnAudio'); let muted=false;
  vol.addEventListener('input', ()=>{ if(!muted){ tracks.forEach(t=>t.volume=+vol.value); } });
  btnAudio.onclick=()=>{ muted=!muted; btnAudio.textContent=muted?'ğŸ”‡ Music off':'ğŸ”Š Music on'; tracks.forEach(t=>t.muted=muted); };

  // éŸ³è¨Šè§£é– + é ç†±ï¼ˆæ”¹å¼·åŒ–ï¼šæŒ‰ã€Œé–‹å§‹éŠæˆ²ã€æ™‚æœƒé€é¦– playâ†’pauseâ†’ç½®é›¶ï¼Œç¢ºä¿æˆæ¬Šï¼‰
  let unlocked=false;
  async function hardUnlock(){
    if(unlocked) return; unlocked=true;
    try{ const C=window.AudioContext||window.webkitAudioContext; const ac=C?new C():null; if(ac && ac.state!=='running') await ac.resume();
      if(ac){ const o=ac.createOscillator(), g=ac.createGain(); g.gain.value=0.0001; o.connect(g).connect(ac.destination); o.start(); setTimeout(()=>o.stop(), 60); }
    }catch(e){}
    // é ç†±æ‰€æœ‰æ›²ç›®èˆ‡ SFX
    for(const media of [...tracks, sfxHit]){
      try{ media.muted=true; await media.play(); await new Promise(r=>setTimeout(r,50)); media.pause(); media.currentTime=0; media.muted=false; }catch(e){}
    }
    dbg('unlocked');
  }

  let currentTrack=-1, fadeId=0;
  function fadeTo(a,target,ms=800){ const s=a.volume, d=target-s, t0=performance.now(); cancelAnimationFrame(fadeId);
    function step(t){ const p=Math.min(1,(t-t0)/ms); a.volume=s+d*p; if(p<1) fadeId=requestAnimationFrame(step); }
    fadeId=requestAnimationFrame(step);
  }

  async function ensurePlay(t){
    // å¼·åŒ–ï¼šåè¦†é‡è©¦ç›´åˆ°æˆåŠŸæ’­æ”¾æˆ–ç”¨æˆ¶éœéŸ³
    for(let i=0;i<5;i++){
      try{ await t.play(); if(!t.paused){ return true; } }catch(e){}
      await new Promise(r=>setTimeout(r,120)); 
    }
    return false;
  }

  async function playBGMForLevel(lv){
    const idx=Math.max(0,Math.min(2,lv-1));
    if(currentTrack===idx && !tracks[idx].paused) return;
    if(currentTrack>=0){ const old=tracks[currentTrack]; fadeTo(old,0,500); setTimeout(()=>{ old.pause(); old.currentTime=0; }, 560); }
    const t=tracks[idx];
    t.muted=muted; if(!muted) t.volume=+vol.value;
    const ok=await ensurePlay(t);
    if(ok){ fadeTo(t, muted?0:+vol.value, 700); currentTrack=idx; dbg('playing lv'+lv); }
    else { dbg('deferred â€” tap again'); }
  }

  function stopAll(ms=560){ tracks.forEach(t=>{ fadeTo(t,0,ms); setTimeout(()=>{ t.pause(); t.currentTime=0; }, ms+40); }); currentTrack=-1; }

  // éŠæˆ²ç‹€æ…‹
  const GRID={rows:3, cols:3}; const HOLES=[]; const ENTITIES=[]; const PARTICLES=[];
  const TYPES={ SKULL:'skull', GOLD:'gold', ARMOR:'armor', RUNE:'rune', GHOST:'ghost', STAR:'star', BOSS:'boss' };
  let level=1, timeLeft=40, score=0, combo=0, freezeUntil=0, stars=0, bossSpawned=false;
  let running=true, lastTick=performance.now();
  let catX=120, catY=120, catVX=60;

  function computeHoles(){ HOLES.length=0; const padX=120, padY=110; const cellW=(cvs.width-padX*2)/(GRID.cols-1); const cellH=(cvs.height-padY*2)/(GRID.rows-1);
    for(let r=0;r<GRID.rows;r++){ for(let c=0;c<GRID.cols;c++){ HOLES.push({x:padX+c*cellW,y:padY+r*cellH}); } } } computeHoles();
  const rand=(a,b)=>a+Math.random()*(b-a); const choice=a=>a[(Math.random()*a.length)|0];
  function resetStats(){ timeLeft=40; score=0; combo=0; stars=0; bossSpawned=false; ENTITIES.length=0; freezeUntil=0; }
  function setHud(){ hud.level.textContent=`${level} / 3`; hud.time.textContent=Math.max(0,Math.ceil(timeLeft)); hud.score.textContent=score; hud.combo.textContent=combo; }

  function spawnEntity(now){
    const hole=choice(HOLES);
    const e={x:hole.x,y:hole.y,born:now,ttl:rand(700,1200),hp:1,t:TYPES.SKULL,radius:38,alpha:1};
    if(level===1){ if(Math.random()<0.15){ e.t=TYPES.GOLD;e.ttl=1000; } }
    else if(level===2){
      const r=Math.random();
      if(r<0.6){ e.t=TYPES.ARMOR;e.hp=2;e.ttl=1200; }
      else if(r<0.8){ e.t=TYPES.SKULL; } else { e.t=TYPES.RUNE;e.ttl=900; }
    } else {
      const r=Math.random();
      if(!bossSpawned && stars>=5 && r<0.1){ e.t=TYPES.BOSS;e.hp=5;e.radius=52;e.ttl=2200; bossSpawned=true; }
      else if(r<0.55){ e.t=TYPES.SKULL;e.ttl=800; }
      else if(r<0.75){ e.t=TYPES.GHOST;e.alpha=0.4;e.ttl=700; }
      else { e.t=TYPES.STAR;e.ttl=900; }
    }
    ENTITIES.push(e);
  }

  function drawCover(img){ if(!img||!img.complete) return; const iw=img.naturalWidth,ih=img.naturalHeight,cw=cvs.width,ch=cvs.height; const ir=iw/ih,cr=cw/ch; let sx,sy,sw,sh;
    if(ir>cr){ sh=ih; sw=ih*cr; sx=(iw-sw)/2; sy=0; } else { sw=iw; sh=iw/cr; sx=0; sy=(ih-sh)/2; } ctx.drawImage(img,sx,sy,sw,sh,0,0,cw,ch);
  }
  function drawBackground(){
    if(panelStart.style.display!=='none'){ drawCover(cover); return; }
    drawCover(level===1?bgs[0]:level===2?bgs[1]:bgs[2]);
    HOLES.forEach(h=>{ ctx.save(); ctx.translate(h.x,h.y); ctx.fillStyle='rgba(0,0,0,.55)'; ctx.beginPath(); ctx.ellipse(0,18,66,24,0,0,Math.PI*2); ctx.fill(); ctx.restore(); });
  }

  function drawSkull(e){ const {x,y,radius}=e; const t=e.t; ctx.save(); ctx.translate(x,y); ctx.globalAlpha=e.alpha??1; const life=(performance.now()-e.born)/e.ttl; const pop=Math.min(1,life*3); const r=radius*(0.85+0.15*pop);
    ctx.fillStyle='rgba(0,0,0,.55)'; ctx.beginPath(); ctx.ellipse(0,28,46,16,0,0,Math.PI*2); ctx.fill();
    let base='#fff'; if(t==='gold') base='#ffd34d'; if(t==='armor') base='#e8ecf3'; if(t==='boss') base='#fff1f1';
    ctx.fillStyle=base; ctx.strokeStyle='#161616'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill(); ctx.stroke();
    ctx.fillStyle='#111'; const eyeR=r*0.18,eyeY=-r*0.15,eyeX=r*0.38; ctx.beginPath(); ctx.arc(-eyeX,eyeY,eyeR,0,Math.PI*2); ctx.arc(eyeX,eyeY,eyeR,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); if(t==='boss'){ ctx.rect(-r*0.45,r*0.2,r*0.9,r*0.22); } else { ctx.ellipse(0,r*0.25,r*0.45,r*0.22,0,0,Math.PI*2);} ctx.fill();
    if(t==='armor'){ ctx.strokeStyle='#7180ff'; ctx.lineWidth=3; ctx.beginPath(); ctx.arc(0,0,r*0.9,0,Math.PI*2); ctx.stroke(); }
    if(t==='gold'){ ctx.strokeStyle='#ffb703'; ctx.lineWidth=3; ctx.setLineDash([6,4]); ctx.beginPath(); ctx.arc(0,0,r*0.92,0,Math.PI*2); ctx.stroke(); }
    ctx.restore();
  }
  function drawRune(e){ const {x,y}=e; ctx.save(); ctx.translate(x,y); ctx.fillStyle='rgba(120,180,255,.15)'; ctx.beginPath(); ctx.arc(0,0,44,0,Math.PI*2); ctx.fill(); ctx.strokeStyle='rgba(120,180,255,.8)'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(0,0,44,0,Math.PI*2); ctx.stroke(); ctx.fillStyle='#9cd3ff'; ctx.font='18px sans-serif'; ctx.textAlign='center'; ctx.fillText('HaHa',0,6); ctx.restore(); }
  function drawStarObj(e){ const {x,y}=e; ctx.save(); ctx.translate(x,y); ctx.beginPath(); const s=5,outer=22,inner=10; let rot=Math.PI/2*3,cx=0,cy=0; ctx.moveTo(0,-outer);
    for(let i=0;i<s;i++){ cx=Math.cos(rot)*outer; cy=Math.sin(rot)*outer; ctx.lineTo(cx,cy); rot+=Math.PI/s; cx=Math.cos(rot)*inner; cy=Math.sin(rot)*inner; ctx.lineTo(cx,cy); rot+=Math.PI/s; }
    ctx.lineTo(0,-outer); ctx.closePath(); ctx.fillStyle='#ffd166'; ctx.strokeStyle='#7a4c00'; ctx.lineWidth=2; ctx.fill(); ctx.stroke(); ctx.restore();
  }

  function spawnHitStars(x,y,count=12){ for(let i=0;i<count;i++){ const ang=Math.random()*Math.PI*2; const sp=120+Math.random()*140; PARTICLES.push({ x,y, vx:Math.cos(ang)*sp, vy:Math.sin(ang)*sp, g:260, life:0, ttl:500+Math.random()*300, size:6+Math.random()*6, rot:Math.random()*Math.PI*2 }); } }
  function drawParticles(dt){ for(let i=PARTICLES.length-1;i>=0;i--){ const p=PARTICLES[i]; p.life+=dt; p.x+=p.vx*dt/1000; p.y+=p.vy*dt/1000; p.vy+=260*dt/1000; const a=1-p.life/p.ttl; if(a<=0){ PARTICLES.splice(i,1); continue; } ctx.save(); ctx.globalAlpha=Math.max(0,a); ctx.translate(p.x,p.y); ctx.rotate(p.rot+p.life*0.01);
      ctx.beginPath(); const s=5,outer=p.size,inner=p.size*0.45; let rot=Math.PI/2*3,cx=0,cy=0; ctx.moveTo(0,-outer);
      for(let k=0;k<s;k++){ cx=Math.cos(rot)*outer; cy=Math.sin(rot)*outer; ctx.lineTo(cx,cy); rot+=Math.PI/s; cx=Math.cos(rot)*inner; cy=Math.sin(rot)*inner; ctx.lineTo(cx,cy); rot+=Math.PI/s; }
      ctx.lineTo(0,-outer); ctx.closePath(); ctx.fillStyle='#ffd166'; ctx.strokeStyle='#7a4c00'; ctx.lineWidth=1.5; ctx.fill(); ctx.stroke(); ctx.restore(); } }

  let spawnAcc=0;
  function update(dt){
    catX += catVX * dt/1000; catY = 100 + Math.sin(performance.now()/600) * 14; if(catX > cvs.width + 80){ catX = -80; catVX = 60 + Math.random()*40; }
    drawParticles(dt);
    if(performance.now()<freezeUntil) return;
    if(panelStart.style.display!=='none') return;
    timeLeft -= dt/1000; if(timeLeft<=0){ endLevel(); return; }
    const rate = level===1?520:level===2?420:320; spawnAcc+=dt; while(spawnAcc>=rate){ spawnEntity(performance.now()); spawnAcc-=rate; }
    const now=performance.now(); for(let i=ENTITIES.length-1;i>=0;i--){ const e=ENTITIES[i]; if(now - e.born > e.ttl){ ENTITIES.splice(i,1); } }
  }

  function drawBossAndCat(){
    if(panelStart.style.display==='none'){
      const img=bosses[Math.max(0,Math.min(2,level-1))];
      if(img && img.complete){
        const t=performance.now()/1000, bob=Math.sin(t*2.2)*6, rot=Math.sin(t*1.6)*0.05, baseW=140;
        const scale=baseW/img.naturalWidth, w=baseW, h=img.naturalHeight*scale, x=cvs.width-w-16, y=cvs.height-h-16+bob;
        ctx.save(); ctx.translate(x+w/2,y+h/2); ctx.rotate(rot); ctx.globalAlpha=0.92; ctx.drawImage(img,-w/2,-h/2,w,h); ctx.restore();
      }
    }
    if(catImg && catImg.complete){
      const t=performance.now()/1000, bob=Math.sin(t*2.8)*8, baseW=110, scale=baseW/catImg.naturalWidth, w=baseW, h=catImg.naturalHeight*scale;
      ctx.save(); ctx.globalAlpha=0.95; ctx.drawImage(catImg, catX, catY + bob, w, h); ctx.restore();
    }
  }

  function render(){
    drawBackground();
    if(panelStart.style.display==='none'){
      ENTITIES.forEach(e=>{ if(e.t==='rune') return drawRune(e); if(e.t==='star') return drawStarObj(e); return drawSkull(e); });
    }
    drawBossAndCat();
    if(panelStart.style.display==='none' && level===3){
      ctx.save(); ctx.fillStyle='#ffd166'; ctx.font='16px sans-serif'; ctx.fillText(`æ˜Ÿæ˜Ÿï¼š${stars} / 5`, cvs.width-120, 40); ctx.restore();
    }
  }

  function loop(){ const now=performance.now(); const dt=now-lastTick; lastTick=now; update(dt); render(); setHud(); requestAnimationFrame(loop); }

  function handlePointer(evt){
    if(performance.now()<freezeUntil) return;
    if(panelStart.style.display!=='none') return;
    const rect=cvs.getBoundingClientRect(); const x=(evt.clientX-rect.left)*(cvs.width/rect.width); const y=(evt.clientY-rect.top)*(cvs.height/rect.height);
    for(let i=ENTITIES.length-1;i>=0;i--){
      const e=ENTITIES[i]; const dx=x-e.x, dy=y-e.y; if(Math.hypot(dx,dy)<(e.radius||44)){
        const t=e.t;
        if(t==='rune'){ freezeUntil=performance.now()+1000; combo=0; ENTITIES.splice(i,1); return; }
        if(t==='star'){ stars++; score+=20; combo++; spawnHitStars(e.x,e.y,10); ENTITIES.splice(i,1); return; }
        if(t==='ghost'){ score=Math.max(0, score-15); combo=0; ENTITIES.splice(i,1); return; }
        e.hp--; combo++; score += 10 * Math.max(1, Math.min(5, combo)); if(t==='gold'){ timeLeft += 5; }
        playHit(); spawnHitStars(e.x,e.y,14); if(e.hp<=0){ ENTITIES.splice(i,1); } return;
      }
    }
    combo=0;
  }
  cvs.addEventListener('pointerdown', handlePointer);

  function startGame(lv){
    level=lv; resetStats(); setHud();
    panelStart.style.display='none'; panelHow.style.display='none'; panelGameOver.style.display='none'; overlay.style.display='none';
    playBGMForLevel(level);
  }

  function backToMenu(){ overlay.style.display='grid'; panelStart.style.display='block'; panelHow.style.display='none'; }

  function endLevel(){
    const need=level===1?300:level===2?450:700; const pass=score>=need && (level<3 || (level===3 && bossSpawned));
    if(pass){
      if(level<3){ showToast(`ç¬¬ ${level} é—œé€šéï¼è‡ªå‹•å‰å¾€ä¸‹ä¸€é—œâ€¦`); level++; resetStats(); setHud(); playBGMForLevel(level); }
      else { overlay.style.display='grid'; panelGameOver.style.display='block'; document.getElementById('goTitle').textContent='ğŸ‰ å…¨éƒ¨é€šé—œï¼'; goText.innerHTML=`æœ€çµ‚åˆ†æ•¸ <b>${score}</b>ï¼`; stopAll(560); }
    } else {
      overlay.style.display='grid'; panelGameOver.style.display='block'; document.getElementById('goTitle').textContent='éŠæˆ²çµæŸ'; goText.innerHTML=`æœ¬é—œåˆ†æ•¸ <b>${score}</b>ï¼ˆç›®æ¨™ ${need}ï¼‰ï¼Œå†æ¥å†å²ï¼`; stopAll(560);
    }
  }
  function showToast(text){ toast.textContent=text; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 900); }

  // UI
  document.getElementById('btnStart').onclick = async () => {
    await hardUnlock();          // å¼·åˆ¶é ç†±
    await playBGMForLevel(1);    // ç¢ºä¿ç¬¬ 1 é¦–æˆåŠŸé–‹å§‹
    startGame(1);
  };
  document.getElementById('btnHow').onclick = () => { panelStart.style.display='none'; panelHow.style.display='block'; };
  document.getElementById('btnBack').onclick = () => { panelHow.style.display='none'; panelStart.style.display='block'; };
  document.getElementById('btnRestart').onclick = () => { panelGameOver.style.display='none'; backToMenu(); };

  function setHud(){ hud.level.textContent=`${level} / 3`; hud.time.textContent=Math.max(0,Math.ceil(timeLeft)); hud.score.textContent=score; hud.combo.textContent=combo; }
  function resize(){ computeHoles(); }
  window.addEventListener('resize', resize);

  // å•Ÿå‹•ï¼šå…ˆé¡¯ç¤ºå°é¢ï¼ˆä¸è‡ªå‹•æ’­ï¼Œæ”¹ç‚ºé»ã€Œé–‹å§‹éŠæˆ²ã€å¾Œæ‰æ’­ï¼Œé¿å…è‡ªå‹•æ’­æ”¾è¢«æ“‹ï¼‰
  loop();
  dbg('ready');
})();
</script>
</body>
</html>
